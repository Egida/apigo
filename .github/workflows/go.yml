runs-on: ubuntu-latest

# Steps represent a sequence of tasks that will be executed as part of the job
steps:
# Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
- name: Checkout the repository
  uses: actions/checkout@v2

- name: Set up Go 1.13
  uses: actions/setup-go@v1
  with: 
    go-version: 1.13         

- name: Build app 
  run: go build -o app main.go

- name: SCP to Ocean
  uses: appleboy/scp-action@master
  with:
    host: ${{ secrets.host }}
    username: ${{ secrets.user }}
    key: ${{ secrets.serverKey }}
    port: 
    source: "app"         
    target: "dist"    

- name: Deploy and rebuild on server
  uses: appleboy/ssh-action@master
  with:
    host: ${{ secrets.host }}
    username: ${{ secrets.user }}
    key: ${{ secrets.serverKey }}
    port: ${{ secrets.port }}
    script:           
      systemctl restart goweb.service &&
      systemctl status goweb
